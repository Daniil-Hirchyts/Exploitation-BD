
--Q1
SELECT villeCamping, COUNT(idCamping) AS "NB CAMPINGS"
FROM Campings
GROUP BY villeCamping;

--Q2
SELECT nomCamping
FROM Campings c JOIN Employes e ON c.idCamping=e.idCamping
GROUP BY nomCamping
HAVING COUNT(idEmploye)>3;

--Q3
SELECT nomCamping, COUNT(idEmploye) as nbEmploye
FROM Campings c LEFT JOIN Employes e ON c.idCamping=e.idCamping
GROUP BY nomCamping
ORDER BY nbEmploye DESC;

--Q4
SELECT nomService, nbCampings
FROM(SELECT nomService, COUNT(DISTINCT idCamping) as nbCampings
FROM Services s JOIN Proposer p ON s.idService=p.idService
				JOIN Bungalows b ON b.idBungalow=p.idBungalow
WHERE categorieService='Luxe'
GROUP BY nomService)

--Q5
SELECT nomClient,prenomClient
FROM Clients
WHERE idClient=(
SELECT idClient
FROM(
SELECT idClient, COUNT(idLocation) as nbLocation
FROM Locations
GROUP BY idClient)
WHERE nbLocation=(SELECT MAX(nbLocation) FROM (SELECT idClient, COUNT(idLocation) as nbLocation
FROM Locations
GROUP BY idClient)));

--Q6
SELECT DISTINCT nomBungalow
FROM(SELECT nomBungalow,b.idBungalow
FROM Bungalows b JOIN Proposer p ON b.idBungalow=p.idBungalow
				 JOIN Services s ON s.idService=p.idService
				 JOIN Locations l ON l.idBungalow=b.idBungalow
WHERE nomService='Kit de Bain')

--Q7
SELECT DISTINCT nomBungalow
FROM Bungalows b JOIN Locations l ON l.idBungalow=b.idBungalow
GROUP BY nomBungalow
HAVING COUNT(*)>4;

--Q8
SELECT COUNT(idClient) as "NB Clients"
FROM Clients c
WHERE villeClient NOT IN(SELECT villeCamping FROM Campings)

--Q9
SELECT nomBungalow, COUNT(idService) as "NB SERVICES"
FROM Bungalows b LEFT JOIN Proposer p ON b.idBungalow=p.idBungalow
				 JOIN Campings c ON c.idCamping=b.idCamping
WHERE nomCamping='La DÃ©charge Monochrome'
GROUP BY nomBungalow
ORDER BY "NB SERVICES"
;

--Q10
SELECT nomBungalow
FROM Bungalows b JOIN Campings c ON b.idCamping=c.idCamping
WHERE nomCamping='Les Flots Bleus' AND superficieBungalow=(SELECT MIN(superficieBungalow) FROM(SELECT superficieBungalow
FROM Bungalows b JOIN Campings c ON b.idCamping=c.idCamping
WHERE nomCamping='Les Flots Bleus'
))

--Q11
SELECT nomBungalow
FROM Bungalows b JOIN Proposer p ON b.idBungalow=p.idBungalow
GROUP BY nomBungalow
HAVING COUNT(*)>=2
INTERSECT
SELECT nomBungalow
FROM Bungalows b JOIN Locations l ON l.idBungalow=b.idBungalow
GROUP BY nomBungalow
HAVING COUNT(*)>2;

--Q12
SELECT nomBungalow
FROM Bungalows b
WHERE idBungalow NOT IN(SELECT idBungalow FROM Locations WHERE dateFin>='01/08/2021' AND dateDebut<='31/08/2021')
;

--Q13
SELECT e1.nomEmploye
FROM Employes e1 JOIN Employes e2 ON e1.idEmploye=e2.idEmployeChef
GROUP BY e1.nomEmploye
HAVING COUNT(e2.idEmployeChef)>1
ORDER BY e1.nomEmploye;

--Q14
SELECT nomClient,prenomClient
FROM Clients c JOIN Locations l ON c.idClient=l.idClient
MINUS
SELECT nomClient,prenomClient
FROM Clients c JOIN Locations l ON c.idClient=l.idClient
WHERE montantLocation<=1200;

--Q15
SELECT nomCamping
FROM (SELECT b.idCamping,nomCamping, COUNT(idService) as nbServ
FROM Bungalows b JOIN Proposer p ON b.idBungalow=p.idBungalow
				 JOIN Campings cp ON cp.idCamping=b.idCamping
GROUP BY b.idCamping,nomCamping)
WHERE nbServ<4
;

--Q16
SELECT nomBungalow
FROM Bungalows
WHERE idBungalow NOT IN(SELECT idBungalow FROM Locations)
INTERSECT
SELECT nomBungalow
FROM Bungalows
WHERE superficieBungalow=
(SELECT MIN(superficieBungalow)
FROM Bungalows
WHERE idBungalow NOT IN(SELECT idBungalow FROM Locations))

--Q17
SELECT c.nomClient,c.prenomClient, NVL(MAX(somme),0)
FROM(
SELECT c.idClient, nomClient,prenomClient
FROM Clients c LEFT JOIN Locations l ON c.idClient=l.idClient
WHERE villeClient='Paris') req1
LEFT JOIN
(
SELECT c.idclient,nomClient,prenomClient, SUM(montantLocation) as somme
FROM Clients c LEFT JOIN Locations l ON c.idClient=l.idClient
WHERE villeClient='Paris' AND dateFin>='01/08/2021' AND dateDebut<='31/08/2021'
GROUP BY c.idclient,nomClient,prenomClient) req2 ON req1.idClient=req2.idClient
JOIN Clients c ON c.idClient=req1.idClient
GROUP BY c.nomClient,c.prenomClient;

-- Q17 BCP MIEUX
SELECT nomClient,prenomClient ,NVL(SUM(montantLocation), 0) as "Montant Total"
FROM Clients c LEFT JOIN Locations l ON c.idClient=l.idClient
AND dateFin>='01/08/2021' 
AND dateDebut<='31/08/2021' 
WHERE villeClient='Paris'
GROUP BY nomClient,prenomClient;

--Q18
SELECT c.nomCamping, nomEmploye, prenomEmploye
FROM(
SELECT c.idCamping, MAX(salaireEmploye) as salairemax
FROM Campings c JOIN Employes e ON c.idCamping=e.idCamping
GROUP BY c.idCamping
) r1
JOIN Campings c ON r1.idCamping=c.idCamping
JOIN Employes e ON e.idCamping=r1.idCamping
WHERE salaireEmploye=salairemax;

--Q19
SELECT nomBungalow,l.dateDebut, SUM(l.montantLocation) as CA
FROM Locations l JOIN Locations l2 ON l.idBungalow=l2.idBungalow
				 JOIN Bungalows b ON b.idBungalow=l.idBungalow
WHERE l2.dateFin<=l.dateDebut
GROUP BY nomBungalow,l.dateDebut