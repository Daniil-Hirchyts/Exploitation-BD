-- 3.1 INSERT

INSERT INTO produit
VALUES (20, 'Cahier', 'Blanc', 100);

INSERT INTO produit(np, lib, qs)
VALUES (21, 'Gomme', 500);

INSERT INTO produit(lib, coul, qs)
VALUES ('trombone', 'Gris', 1000);

INSERT INTO achat
VALUES (101, 20, 12);

-- 3.2 DELETE

DELETE
FROM produit
WHERE np = 21;

DELETE
FROM produit
WHERE np = 20;

DELETE
FROM achat
WHERE qa < 5;

SELECT ncli
FROM client
WHERE nom = 'Ullman';

DELETE
FROM achat
WHERE ncli IN (SELECT ncli FROM client WHERE nom = 'Ullman');

-- 3.3 UPDATE

UPDATE achat
SET qa = qa + 10
WHERE ncli IN (SELECT ncli FROM client c WHERE nom = 'Defrere')
  and np IN (SELECT np from produit WHERE lib = 'Agrafeuse')

UPDATE produit
SET qs  = qs + 10,
    coul='Jaune'
WHERE lib = 'Crayon Luxe' and coul='Rouge';

UPDATE achat
SET qa = qa + 2
WHERE ncli IN (SELECT ncli
               FROM client
               WHERE nom = 'Defrere');

-- 4.1 ALTER


ALTER TABLE client
    ADD adr VARCHAR(40);

ALTER TABLE client
    MODIFY adr VARCHAR(80);

UPDATE client
SET adr='Montpellier';

ALTER TABLE client
    MODIFY adr DEFAULT 'Mende';

-- 4.2 CREATE

CREATE TABLE FOURNISSEUR
(
    nf  INTEGER,
    nom VARCHAR(40) NOT NULL,
    adr VARCHAR(40) NOT NULL,
    CONSTRAINT pk_fournisseur PRIMARY KEY(nf)
);

CREATE TABLE REAP
(
    NF INTEGER,
    NP INTEGER,
    DATEREAP DATE DEFAULT CURRENT_DATE,
    QR INTEGER NOT NULL CONSTRAINT qr_positif CHECK (QR > 0),
    CONSTRAINT pk_reap PRIMARY KEY (NF, NP, DATEREAP),
    CONSTRAINT fk_reap_nf FOREIGN KEY (nf) REFERENCES Fournisseur (nf),
    CONSTRAINT fk_reap_np FOREIGN KEY (np) REFERENCES Produit (np)
);

INSERT INTO REAP(NF, NP, DATEREAP, QR) VALUES (1001, 1, CURRENT_DATE, 51);
INSERT INTO REAP VALUES (1001, 4, CURRENT_DATE, 100);
INSERT INTO REAP VALUES (1001, 5, CURRENT_DATE, 100);
INSERT INTO REAP VALUES (1001, 6, CURRENT_DATE, 100);
INSERT INTO REAP VALUES (1001, 7, CURRENT_DATE, 100);
INSERT INTO REAP VALUES (1001, 7, '2020-01-01', 49);
INSERT INTO REAP VALUES (1002, 7, '2020-01-01', 500);
INSERT INTO REAP VALUES (1003, 1, '2020-01-01', 49);
INSERT INTO REAP VALUES (1003, 9, '2020-01-01', 100);
INSERT INTO REAP VALUES (1003, 9, '2020-02-01', 50);
INSERT INTO REAP VALUES (1003, 10, '2020-01-01', 200);



-- Q1 Quels sont les numéros fournisseurs qui on déjà rapprovisionné des 'Lampe' ou des 'Agrafeuse' ?

SELECT r.NF
FROM REAP r
WHERE r.NP IN (SELECT np
               FROM PRODUIT
               WHERE lib IN ('Lampe', 'Agrafeuse'));



